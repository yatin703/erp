SELECT od.cap_code,YEAR(om.approval_date) AS order_year, 
LEFT(MONTHNAME (om.approval_date),3) AS order_month,
MONTH(om.approval_date) as order_month_no,article_name_info.adr_category_id, 
address_category_master.category_name as customer, om.order_no,
od.article_no,if(om.for_export<>1 , (od.selling_price/100),(od.calc_sell_price)*(om.exchange_rate/100))as unit_price, od.sleeve_dia, od.total_order_quantity /100 AS quantity,lm.printing_group, IFNULL(sum( ar.arid_qty /100 ),0) AS dispatch, 
if( sum( ar.arid_qty /100 ) < ( od.total_order_quantity /100 ) , (od.total_order_quantity /100) - sum( ar.arid_qty /100 ), 0 ) AS pending, if(lm.printing_group='SCREEN+FLEXO', if( IFNULL(sum( ar.arid_qty /100 ),0) < ( od.total_order_quantity /100 ) , (od.total_order_quantity /100) - IFNULL(sum( ar.arid_qty /100),0), 0 ),0) as SCREEN_FLEXO_PENDING, if(lm.printing_group='SCREEN+FLEXO',if(om.for_export<>1 , (od.selling_price/100),(od.calc_sell_price)*(om.exchange_rate/100))*if( IFNULL(sum( ar.arid_qty / 100),0) < ( od.total_order_quantity / 100 ) , ( od.total_order_quantity / 100 ) - IFNULL(sum( ar.arid_qty / 100),0) , 0 ),0) as SCREEN_FLEXO_PENDING_VAL, if(lm.printing_group='OFFSET', if( IFNULL(sum( ar.arid_qty /100),0) < ( od.total_order_quantity /100 ) , (od.total_order_quantity /100) - IFNULL(sum( ar.arid_qty /100),0), 0 ),0) as OFFSET_PENDING, if(lm.printing_group='OFFSET',if(om.for_export<>1 , (od.selling_price/100),(od.calc_sell_price)*(om.exchange_rate/100))*if( IFNULL(sum( ar.arid_qty / 100),0) < ( od.total_order_quantity / 100 ) , ( od.total_order_quantity / 100 ) - IFNULL(sum( ar.arid_qty / 100),0) , 0 ),0) as OFFSET_PENDING_VAL, if(lm.printing_group='LABEL', if( IFNULL(sum( ar.arid_qty /100),0) < ( od.total_order_quantity /100 ) , (od.total_order_quantity /100) - IFNULL(sum( ar.arid_qty /100),0), 0 ),0) as LABEL_PENDING, if(lm.printing_group='LABEL',if(om.for_export<>1 , (od.selling_price/100),(od.calc_sell_price)*(om.exchange_rate/100))*if( IFNULL(sum( ar.arid_qty / 100),0) < ( od.total_order_quantity / 100 ) , ( od.total_order_quantity / 100 ) - IFNULL(sum( ar.arid_qty / 100),0) , 0 ),0) as LABEL_PENDING_VAL, if(lm.printing_group='FLEXO+DIGITAL+FLEXO', if( IFNULL(sum( ar.arid_qty /100),0) < ( od.total_order_quantity /100 ) , (od.total_order_quantity /100) - IFNULL(sum( ar.arid_qty /100),0), 0 ),0) as DIGITAL_PENDING, if(lm.printing_group='FLEXO+DIGITAL+FLEXO',if(om.for_export<>1 , (od.selling_price/100),(od.calc_sell_price)*(om.exchange_rate/100))*if( IFNULL(sum( ar.arid_qty / 100),0) < ( od.total_order_quantity / 100 ) , ( od.total_order_quantity / 100 ) - IFNULL(sum( ar.arid_qty / 100),0) , 0 ),0) as DIGITAL_PENDING_VAL, if(lm.printing_group IS NULL, if( IFNULL(sum( ar.arid_qty /100),0) < ( od.total_order_quantity /100 ) , (od.total_order_quantity /100) - IFNULL(sum( ar.arid_qty /100),0), 0 ),0) as UNKNOWN_PENDING FROM `order_master` AS om INNER JOIN order_details AS od ON om.order_no = od.order_no LEFT JOIN ar_invoice_details AS ar ON om.order_no = ar.ref_ord_no AND od.article_no = ar.article_no /*LEFT JOIN ar_invoice_master AS am ON ar.ar_invoice_no = am.ar_invoice_no*/ LEFT JOIN lacquer_types_master AS lm ON od.print_type = lm.lacquer_type LEFT JOIN article_name_info ON od.article_no=article_name_info.article_no LEFT JOIN address_category_master ON article_name_info.adr_category_id=address_category_master.adr_category_id WHERE om.approval_date BETWEEN '2020-12-02' AND '2021-11-22' AND om.final_approval_flag = '1' AND om.trans_closed<>'1' AND om.for_stock<>1 AND od.print_type<>'' AND article_name_info.company_id='000020' /*AND am.cancel_invoice <>1*/ GROUP BY om.order_no,od.article_no,article_name_info.adr_category_id