SELECT om.order_no,od.article_no,od.total_order_quantity/100 as quantity,od.spec_id,od.spec_version_no,bm.print_type,lm.printing_group, sum(ar.arid_qty/100) as dispatch,
bm.sleeve_code,ss.spec_id,ss.spec_version_no,sss.relating_master_value
FROM `order_master` as om
INNER JOIN order_details as od on om.order_no=od.order_no 
LEFT JOIN bill_of_material as bm ON od.spec_id=bm.bom_no AND od.spec_version_no=bm.bom_version_no
LEFT JOIN ar_invoice_details as ar ON om.order_no=ar.ref_ord_no AND od.article_no=ar.article_no
LEFT JOIN ar_invoice_master as am ON ar.ar_invoice_no=am.ar_invoice_no 
LEFT JOIN lacquer_types_master as lm ON bm.print_type=lm.lacquer_type 
LEFT JOIN specification_sheet as ss ON bm.sleeve_code=ss.article_no
LEFT JOIN specification_sheet_details as sss ON ss.spec_id=sss.spec_id AND ss.spec_version_no=sss.spec_version_no
where om.order_date between '2019-12-01' AND '2019-12-03' 
AND om.final_approval_flag='1' 
AND om.`trans_closed`!='1'
AND am.cancel_invoice<>1
AND om.for_sampling<>1
AND sss.parameter_name='DIA'
AND sss.item_group_id=3
AND om.order_no='SO-19-20-3029'
group by om.order_no,od.article_no


SELECT om.order_no,od.article_no,od.total_order_quantity/100 as quantity,od.spec_id,od.spec_version_no,bm.print_type,lm.printing_group, sum(ar.arid_qty/100) as dispatch,
bm.sleeve_code,ss.spec_id
FROM `order_master` as om
INNER JOIN order_details as od on om.order_no=od.order_no 
LEFT JOIN bill_of_material as bm ON od.spec_id=bm.bom_no AND od.spec_version_no=bm.bom_version_no
LEFT JOIN ar_invoice_details as ar ON om.order_no=ar.ref_ord_no AND od.article_no=ar.article_no
LEFT JOIN ar_invoice_master as am ON ar.ar_invoice_no=am.ar_invoice_no 
LEFT JOIN lacquer_types_master as lm ON bm.print_type=lm.lacquer_type 
LEFT JOIN specification_sheet as ss ON bm.sleeve_code=ss.article_no
LEFT JOIN 
where om.order_date between '2019-12-01' AND '2019-12-03' 
AND om.final_approval_flag='1' 
AND om.`trans_closed`!='1'
AND am.cancel_invoice<>1
AND om.for_sampling<>1
AND om.order_no='SO-19-20-3029'
AND om.
group by om.order_no,od.article_no


SELECT om.order_no,od.article_no,od.total_order_quantity/100 as quantity,od.spec_id,od.print_type,lm.printing_group, sum(ar.arid_qty/100) as dispatch,
(od.total_order_quantity/100)-sum(ar.arid_qty/100) as pending
FROM `order_master` as om
INNER JOIN order_details as od on om.order_no=od.order_no 
LEFT JOIN ar_invoice_details as ar ON om.order_no=ar.ref_ord_no AND od.article_no=ar.article_no
LEFT JOIN ar_invoice_master as am ON ar.ar_invoice_no=am.ar_invoice_no 
LEFT JOIN lacquer_types_master as lm ON od.print_type=lm.lacquer_type 
where om.order_date between '2019-12-01' AND '2019-12-03' 
AND om.final_approval_flag='1' 
AND om.`trans_closed`!='1'
AND am.cancel_invoice<>1
AND om.for_sampling<>1
AND om.order_no='SO-19-20-3029'
group by om.order_no,od.article_no




SELECT om.order_no, od.article_no, od.total_order_quantity /100 AS quantity, od.spec_id, od.print_type, lm.printing_group, sum( ar.arid_qty /100 ) AS dispatch, if( sum( ar.arid_qty /100 ) < ( od.total_order_quantity /100 ) , (
od.total_order_quantity /100
) - sum( ar.arid_qty /100 ) , 0 ) AS pending
FROM `order_master` AS om
INNER JOIN order_details AS od ON om.order_no = od.order_no
LEFT JOIN ar_invoice_details AS ar ON om.order_no = ar.ref_ord_no
AND od.article_no = ar.article_no
LEFT JOIN ar_invoice_master AS am ON ar.ar_invoice_no = am.ar_invoice_no
LEFT JOIN lacquer_types_master AS lm ON od.print_type = lm.lacquer_type
WHERE om.order_date
BETWEEN '2020-01-25'
AND '2020-02-05'
AND om.final_approval_flag = '1'
AND om.`trans_closed` != '1'
AND am.cancel_invoice <>1
AND om.for_sampling <>1
GROUP BY om.order_no, od.article_no



SELECT 
om.order_no, od.article_no, od.total_order_quantity /100 AS quantity, od.spec_id, od.print_type, lm.printing_group, sum( ar.arid_qty /100 ) AS dispatch, 
if( sum( ar.arid_qty /100 ) < ( od.total_order_quantity /100 ) , (od.total_order_quantity /100) - sum( ar.arid_qty /100 ), 0 ) AS pending
FROM `order_master` AS om
INNER JOIN order_details AS od ON om.order_no = od.order_no
LEFT JOIN ar_invoice_details AS ar ON om.order_no = ar.ref_ord_no
AND od.article_no = ar.article_no
LEFT JOIN ar_invoice_master AS am ON ar.ar_invoice_no = am.ar_invoice_no
LEFT JOIN lacquer_types_master AS lm ON od.print_type = lm.lacquer_type
WHERE om.order_date
BETWEEN '2020-01-25'
AND '2020-02-05'
AND om.final_approval_flag = '1'
AND om.`trans_closed` != '1'
AND am.cancel_invoice <>1
AND om.for_sampling <>1
GROUP BY  om.order_no,od.article_no



SELECT A.sleeve_dia,sum(A.SCREEN_FLEXO_PENDING), sum(A.OFFSET_PENDING), sum(A.LABEL_PENDING) from (SELECT 
om.order_no, od.article_no, od.sleeve_dia, od.total_order_quantity /100 AS quantity,lm.printing_group, sum( ar.arid_qty /100 ) AS dispatch, 
if( sum( ar.arid_qty /100 ) < ( od.total_order_quantity /100 ) , (od.total_order_quantity /100) - sum( ar.arid_qty /100 ), 0 ) AS pending,

if(lm.printing_group='SCREEN+FLEXO', if( sum( ar.arid_qty /100 ) < ( od.total_order_quantity /100 ) , (od.total_order_quantity /100) - sum( ar.arid_qty /100 ), 0 ),0) as SCREEN_FLEXO_PENDING,

if(lm.printing_group='OFFSET', if( sum( ar.arid_qty /100 ) < ( od.total_order_quantity /100 ) , (od.total_order_quantity /100) - sum( ar.arid_qty /100 ), 0 ),0) as OFFSET_PENDING,

if(lm.printing_group='LABEL', if( sum( ar.arid_qty /100 ) < ( od.total_order_quantity /100 ) , (od.total_order_quantity /100) - sum( ar.arid_qty /100 ), 0 ),0) as LABEL_PENDING

FROM `order_master` AS om
INNER JOIN order_details AS od ON om.order_no = od.order_no
LEFT JOIN ar_invoice_details AS ar ON om.order_no = ar.ref_ord_no
AND od.article_no = ar.article_no
LEFT JOIN ar_invoice_master AS am ON ar.ar_invoice_no = am.ar_invoice_no
LEFT JOIN lacquer_types_master AS lm ON od.print_type = lm.lacquer_type
WHERE om.order_date
BETWEEN '2020-01-15'
AND '2020-02-05'
AND om.final_approval_flag = '1'
AND om.`trans_closed` != '1'
AND am.cancel_invoice <>1
AND om.for_sampling <>1
GROUP BY  om.order_no,od.article_no) AS A 
GROUP BY A.sleeve_dia
